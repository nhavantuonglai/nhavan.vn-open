---
import CommonImage from '~/components/common/image.astro';
import type { CallToAction } from '~/types';
import Button from '~/components/ui/button.astro';

export interface Props {
	title?: string;
	subtitle?: string;
	content?: string;
	actions?: string | CallToAction[];
	image?: string | { src: string; alt?: string; title?: string };
	headingLevel?: 'h1' | 'h2';
	color?: 'white' | 'primary';
	standalone?: boolean;
}

const {
	title = await Astro.slots.render('title'),
	subtitle = await Astro.slots.render('subtitle'),
	content = await Astro.slots.render('content'),
	actions = await Astro.slots.render('actions'),
	image,
	headingLevel = 'h1',
	color = 'primary',
	standalone = false
} = Astro.props;

const colorClasses = {
	white: {
		heading: 'text-white',
		text: 'text-white'
	},
	primary: {
		heading: 'text-primary',
		text: 'text-mute'
	}
};

const { heading: colorheading, text: colortext } = colorClasses[color];

const imageProps = typeof image === 'string' 
	? { src: image, alt: 'Diễn đàn viết lách nhà văn tương lai.', title: 'Diễn đàn viết lách nhà văn tương lai.' } 
	: image;

const hasActions = actions && (Array.isArray(actions) ? actions.length > 0 : true);
---

<section class={standalone ? "relative w-full h-screen not-prose" : "relative w-full h-screen not-prose"}>
	
	{standalone && <div class="absolute inset-0 pointer-events-none" aria-hidden="true"></div>}
	
	<div class="relative max-w-7xl mx-auto px-4 sm:px-6">

		<div class="pt-0 md:pt-[120px] pointer-events-none"></div>
		<div class="py-12 md:py-20 grid gap-6 md:grid-cols-2 max-w-full">

			<div class="pb-10 md:pb-16 mx-auto lg:mx-0 w-full">

				{title && (
					<Fragment>
						{headingLevel === 'h1' ? (
							<h1 class={colorheading} set:html={title} />
						) : (
							<h2 class={colortext} set:html={title} />
						)}
					</Fragment>
				)}

				<div class="w-full max-w-3xl mx-auto">

					{subtitle && (
						<p class={colortext} set:html={subtitle} />
					)}

					{hasActions && (
						<div class="max-w-xs sm:max-w-md flex flex-col sm:flex-row gap-4">
							{Array.isArray(actions) ? (
								actions.map((action, index) => (
									<div key={index} class="flex w-full sm:w-auto">
										<Button {...(action || {})} class="w-full sm:mb-0" target="_blank" />
									</div>
								))
							) : (
								<Fragment set:html={actions} />
							)}
						</div>
					)}

					{content && <Fragment set:html={content} />}

				</div>

			</div>

			{imageProps && (
				<div class="pb-10 md:pb-16 mx-auto lg:mx-0 w-full">
					<div class="relative m-auto max-w-5xl">
						<CommonImage
							src={imageProps.src}
							alt={imageProps.alt}
							title={imageProps.title}
							loading="eager"
						/>
					</div>
				</div>
			)}

		</div>
	</div>
</section>

<script>

	document.addEventListener('DOMContentLoaded', function() {
		const heroReadyEvent = new CustomEvent('heroReady');
		document.dispatchEvent(heroReadyEvent);
		const heroSection = document.querySelector('section');
		
		if (heroSection) {
			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
					if (entry.isIntersecting) {
						const galleryImages = document.getElementById('gallery-images');
						if (galleryImages) {
							galleryImages.style.opacity = '1';
						}
						observer.unobserve(entry.target);
					}
				});
			}, { threshold: 0.1 });
			
			observer.observe(heroSection);
		}
	});

</script>