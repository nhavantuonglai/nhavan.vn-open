---
import Analytics from '~/components/widgets/analytics.astro';

const subtitle = "Hướng dẫn: Địa chỉ IP của tôi là gì? cho phép cập nhật chính xác địa chỉ IP hiện tại, để dễ dàng định vị, đo lường và điều chỉnh các thiết lập phù hợp.";
const default = "Địa chỉ IP của tôi là gì?";

---

<Analytics

	subtitle={subtitle}

	id="address"
	type="hidden"

/>

<script client:load>

	document.addEventListener('DOMContentLoaded', () => {
		const ipAddressOutput = document.getElementById('address-text-output');

		let lastFetchTime = 0;
		const fetchInterval = 5000;

		async function fetchIP() {
			const now = Date.now();

			if (now - lastFetchTime < fetchInterval) {
				requestAnimationFrame(fetchIP);
				return;
			}

			ipAddressOutput.textContent = 'Đang tìm kiếm địa chỉ IP.';

			try {
				const response = await fetch('https://ipinfo.io/json?token=87aa8f284fb4f6');
				const data = await response.json();
				ipAddressOutput.textContent = `Địa chỉ IP của tôi là ${data.ip || 'không xác định'}.`;
				document.title = `Địa chỉ IP của tôi là ${data.ip || 'không xác định'} | nhavantuonglai`;
			} catch {
				ipAddressOutput.textContent = 'Địa chỉ IP của tôi là không xác định.';
				document.title = `${default} | nhavantuonglai`;
			}

			lastFetchTime = now;
			requestAnimationFrame(fetchIP);
		}

		requestAnimationFrame(fetchIP);
	});

</script>